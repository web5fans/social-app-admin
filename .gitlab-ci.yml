image: node:22-alpine

workflow:
  rules:
    - if: $CI_COMMIT_TITLE =~ /skip-ci$/
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - when: always

variables:
  # 如: rivtrust/rivdap/nft-frontend
  IMAGE_NAME: "$RIVTOWER_REGISTRY_ADDRESS/xiangjiandao/social-app-admin"
  # chart仓库地址
  CHART_REPO: "https://$RIVTOWER_REGISTRY_ADDRESS/chartrepo/xiangjiandao"
  # 仓库名
  CHART_REPO_NAME: "xiangjiandao"
  # chart name
  CHART_NAME: "social-app-admin"

stages:
  - build
  - send-helm
  - deploy

null-job:
  stage: build
  script: "exit 0"
  only:
    - __not_exist__

include:
  - local: 'ci/pipelines/development.yml'
    rules:
      - if: $CI_COMMIT_BRANCH == "develop"

  - local: 'ci/pipelines/staging.yml'
    rules:
      - if: $CI_COMMIT_BRANCH == "test"
      - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "test"

  - local: 'ci/pipelines/release.yml'
    rules:
      - if: $CI_COMMIT_TAG =~ /^release-/
